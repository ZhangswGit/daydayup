<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.swapServer.mapper.UserMapper">

    <select id="findAllUser" resultMap="com.swapServer.mapper.CommonMapper.UserResultMap">
        select
        u.*
        from user u where 1=1
        <if test="query.phone != null and query.phone != ''">
            and u.phone like CONCAT('%',#{query.phone},'%')
        </if>
        <if test="query.email != null and query.email != ''">
            and u.email like CONCAT('%',#{query.email},'%')
        </if>
        <if test="query.nickName != null and query.nickName != ''">
            and u.nick_name like CONCAT('%',#{query.nickName},'%')
        </if>
        <include refid="com.swapServer.mapper.CommonMapper.condition"/>
    </select>

    <select id="findUserById" resultMap="com.swapServer.mapper.CommonMapper.UserResultMap">
        select
        u.*
        from user u where u.id = #{id}
        <include refid="com.swapServer.mapper.CommonMapper.condition"/>
    </select>

    <select id="findUserByNameOrPhoneOrEmail" resultMap="com.swapServer.mapper.CommonMapper.UserResultMap">
        select
        u.*
        from user u where (u.name = #{unique} or u.phone = #{unique} or u.email = #{unique})
        <include refid="com.swapServer.mapper.CommonMapper.condition"/>
    </select>

    <select id="findUserByNameOrPhoneOrEmail" resultMap="com.swapServer.mapper.CommonMapper.UserResultMap">
        select
        u.*
        from user u where (u.phone = #{unique} or u.email = #{unique})
        <include refid="com.swapServer.mapper.CommonMapper.condition"/>
    </select>

    <select id="findUserByPhoneOrEmailWithOutId" resultMap="com.swapServer.mapper.CommonMapper.UserResultMap">
        select
        u.*
        from user u where (u.phone = #{unique} or u.email = #{unique}) and u.id != #{id}
        <include refid="com.swapServer.mapper.CommonMapper.condition"/>
    </select>

    <update id="deleteByLogic">
        update user set is_delete = id where id = #{id}
        <include refid="com.swapServer.mapper.CommonMapper.condition"/>
    </update>

</mapper>
